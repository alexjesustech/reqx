# syntax=docker/dockerfile:1.7
# reqx Alpine Build - Static Binary
FROM rust:1.83-alpine AS builder

RUN apk add --no-cache \
    musl-dev \
    openssl-dev \
    openssl-libs-static \
    pkgconf

WORKDIR /build
COPY . .

ENV RUSTFLAGS="-C target-feature=+crt-static"
RUN cargo build --release --target x86_64-unknown-linux-musl

# Minimal runtime
FROM scratch AS runtime
COPY --from=builder /build/target/x86_64-unknown-linux-musl/release/reqx /reqx
ENTRYPOINT ["/reqx"]
